---
title: flink-window.md
date: 2018-04-16 07:45:49
tags:
---

1. 检查点VS保存点

    使用数据流API编写的程序可以从保存点来恢复执行。保存点允许你在更新程序的同时还能保证Flink集群不丢失任何状态。

    保存点是人工触发的检查点，它会对应用程序做快照并将快照存入持久化存储（state backend）。保存点依赖于常规的检查点机制，在程序执行期间，Flink会周期性得在工作节点上执行快照并产生检查点。恢复机制仅仅需要最新的已完成的检查点，一旦有新的检查点完成，老的检查点就可以被安全地丢弃。

    保存点跟那些周期性的检查点是相似的。不同点有两个：

    它们是由用户触发的 当有新的已完成的检查点产生的时候，不会自动失效
    保存点存在一个指向检查点的指针，使该检查点不会被过期回收，即真实的状态不会被拷贝给保存点，但是关联的检查点的状态会得到保存。

1. 为保证flink支持故障恢复，保存点的存储应满足以下特性：

    - 启用检查点功能：在每种情况下，我们都推荐在构建Flink程序的同时，把检查点功能打开，事实上在你的Flink程序中加上检查点只是需要增加几行代码而已。
    - 可以重置的数据源（即Apache Kafka、Amazon Kinesis，或者文件系统等）：数据源必须能按照你想要重新处理的点开始，重放数据。
    - 所有的状态都通过Flink的管理状态接口保存：所有具体的操作者的状态都必须保存在Flink的容错状态数据结构中，这让它可以按照某个之前的保存点位置被重置。
    - 配置一个合适的状态后台：Flink提供了不同的状态后台来将检查点和保存点持久化。默认地，保存点都保存在JobManager中，但你要为你的程序配置一个适当的后台状态程序，比如RocksDB等。

3. Window 窗口的种类
    - 翻滚窗口（Tumbling Window，无重叠）
    - 滚动窗口（Sliding Window，有重叠）
    - 和会话窗口（Session Window，活动间隙）以session间隙来分割窗口
